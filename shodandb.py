#Import the Shodan Library
from shodan import WebAPI

import pickle

class ShodanDB_Search:
  """Searches the shodan database for exploits that are in shodan, msf and exploitd"""

  def __init__(self,search):
    
    #Attributes
    
    self.configFile = "config.dat"
    self.dataList = []
    self.resultsList = None
    self.API_KEY = ""
    self.loadData()
    self.API_KEY = self.dataList[0]

    
    try:
      self.api = WebAPI(self.API_KEY)
    except Exception as e:
      print("Could not connect to Shodan! Try entering a working API Key!\n",e)
      self.getAPI_Key()

      
    self.search = search

##  def main(self):
##
##    

  def loadData(self): 
    with open(self.configFile, mode="rb") as myFile:

      self.dataList = pickle.load(myFile)

  def getAPI_Key(self):
    
    accepted = False
    
    while accepted == False:
    
      if self.API_KEY == "":
        
        print("API Key not given - enter below!")
        print("If you have not got an API Key then visit - www.shodanhq.com")

        try:
          
          getKey = input("Enter API Key: ")
          self.API_KEY = getKey

          self.dataList.append(self.API_KEY)
          #write the data to config file for persistence
          
          with open(self.configFile, mode="wb") as myFile:
            pickle.dump(self.dataList, myFile)
            
          accepted = True
        except:
          print("Please enter a correct API Key")
    if accepted == True:

      self.API_KEY = getKey
      

if __name__ == "__main__":


  new = ShodanDB_Search("hello")
